<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>Data dari COBACOBA</title>
    <!-- Menggunakan Bootstrap untuk tampilan tabel yang lebih rapi -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding: 20px;
        background-color: #f8f9fa;
      }
      .container {
        background-color: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      h1 {
        color: #343a40;
        margin-bottom: 25px;
      }
      .table-responsive {
        margin-top: 20px;
      }
      .loading {
        text-align: center;
        font-size: 1.2em;
        color: #6c757d;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Data dari Spreadsheet COBAJE - Sheet COBACOBA</h1>
      
      <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered">
          <thead class="table-dark">
            <tr>
              <th>Nama HP</th>
              <th>G Dana</th>
              <th>Nama Dana</th>
              <th>PIN Dana</th>
              <th>Nomor Dana</th>
              <th>Masa Aktif</th>
              <th>Last Check</th>
              <th>Hasil</th>
              <th>Status</th>
              <th>Name Check</th>
            </tr>
          </thead>
          <tbody id="table-body">
            <!-- Pesan loading akan muncul di sini saat data dimuat -->
            <tr>
              <td colspan="10" class="loading">Memuat data...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      // Fungsi yang akan dijalankan saat halaman selesai dimuat
      window.onload = function() {
        // Memanggil fungsi 'getDataFromSheet' dari Code.gs
        // .withSuccessHandler(handleSuccess) -> Jika berhasil, jalankan fungsi handleSuccess
        // .withFailureHandler(handleFailure) -> Jika gagal, jalankan fungsi handleFailure
        google.script.run
          .withSuccessHandler(handleSuccess)
          .withFailureHandler(handleFailure)
          .getDataFromSheet();
      };

      // Fungsi untuk menangani data yang berhasil diambil
      function handleSuccess(data) {
        const tableBody = document.getElementById('table-body');
        tableBody.innerHTML = ''; // Kosongkan pesan "Memuat data..."

        if (data.error) {
          // Jika ada error dari server, tampilkan pesannya
          tableBody.innerHTML = `<tr><td colspan="10" class="text-danger text-center">Error: ${data.error}</td></tr>`;
          return;
        }

        if (data.length === 0) {
          // Jika tidak ada data di sheet
          tableBody.innerHTML = `<tr><td colspan="10" class="text-center text-muted">Tidak ada data untuk ditampilkan.</td></tr>`;
          return;
        }

        // Loop melalui setiap baris data dan tambahkan ke tabel
        data.forEach(function(row) {
          const newRow = tableBody.insertRow(); // Buat baris baru <tr>
          
          // Loop melalui setiap kolom di baris tersebut
          row.forEach(function(cellData) {
            const newCell = newRow.insertCell(); // Buat sel baru <td>
            newCell.textContent = cellData;     // Isi sel dengan data
          });
        });
      }

      // Fungsi untuk menangani error jika pemanggilan ke Apps Script gagal
      function handleFailure(error) {
        const tableBody = document.getElementById('table-body');
        tableBody.innerHTML = `<tr><td colspan="10" class="text-danger text-center">Gagal memuat data. Error: ${error.message}</td></tr>`;
        console.error(error);
      }
    </script>
  </body>
</html>
